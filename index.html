<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <title>Declining American Dream vs. 2016 Election Results</title>
</head>

<script
  src="https://code.jquery.com/jquery-1.12.4.min.js"
  integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
  crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.4.0/d3.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>

<style>
  #map {
    width: 1600px;
    height: 600px
  }
</style>

<body>
  <div id="map"></div> 
</body>

<script>

$.getJSON('./data/election.json')
  .then(function (election) {
    console.log(election);
  })

$.get('./data/mobility.csv')
  .then(function (mobility) {
    var states = {};
    mobility = mobility.split('\n');
    mobility.forEach(function (ea) {
      var row = ea.split(',');
      var state = row[1];
      var year = row[2];
      var mean = row[3];
      
      if (!states.hasOwnProperty(state)) {
        states[state] = {year: {}};
      }

      states[state]['year'][year] = Number(mean);
    });

    drawMap(states)
  })

function drawMap (states) {
  var width  = 1000,  
      height = 800,
  svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);

  var center = [39.50, -98.35];
  var projection = d3.geoConicConformal()  
    .center(center)
    .clipAngle(180)
    .scale(10000)
    .translate([width / 2, height / 2])
    .precision(.1);

  var path = d3.geoPath().projection(projection);
  
  d3.json("./data/states.json", function(err, data) {  
    svg.append("path")
      .datum(topojson.feature(data, data.objects.units))
      .attr("d", d3.geoPath().projection(d3.geoMercator()));
  });
}  

</script>

</html>